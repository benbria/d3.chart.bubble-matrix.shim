/*! d3.chart.bubble-matrix v0.1.2 - MIT Expat */
!function(a){return"object"==typeof exports&&"object"==typeof module?(module.exports=a(require("d3"),require("d3.chart"),require("d3.chart.base"),requure("lodash")),void 0):"function"==typeof define&&define.amd?define(["d3","d3.chart","d3.chart.base","lodash"],a):(this.d3ChartBubbleMatrix=a(this.d3,this.d3Chart,this.d3ChartBase,this._),void 0)}(function(a,b,c,d){"use strict";var e={};return function(){e.makeProp=function(a,b){return function(c){return null==c?this[a]:(this[a]=c,null!=b&&b.call(this,c),this)}},e.textRuler=function(a){var b,c;return b=function(b,c){var d,e;return d=a.append("text").text(b),e=c(d),d.remove(),e},c=d.memoize(function(a){return b(a,function(a){return a.node().getComputedTextLength()})}),c.extentOfChar=d.memoize(function(a){if(a.length<1)throw new Error("char can't be empty");if(a.length>1)throw new Error("can get extent of a full string");return b(a,function(a){return a.node().getExtentOfChar(0)})}),c.onTmpText=b,c},e.layers={}}.call(this),function(){var a,b,c,d,f,g,h;a={events:{}},b=.15,a.dataBind=function(a){var b;return b=this.chart(),b.bubbleKey_=b.colKey_?function(c,d){return b.colKey_(a.cols[d],d)}:void 0,this.selectAll("g.row").data(a.rows,b.rowKey_)},a.insert=function(){var a;return a=this.chart(),this.append("g").classed("row",!0)},c=function(a,b){return this.attr("r",0),this.attr("fill",function(a){return b.colorScale_(b.color_(a))}),this.attr("opacity",0),this.attr("cx",function(a,c){return b.xScale_(c)})},d=function(a,c){return this.attr("stroke-width",b*c.maxRadius_)},f=function(){return this.remove()},g=function(a,b){return this.duration(b.duration_),this.attr("opacity",1),this.attr("cx",function(a,c){return b.xScale_(c)}),this.attr("r",function(a){return b.radiusScale_(b.size_(a))}),this.attr("fill",function(a){return b.colorScale_(b.color_(a))})},h=function(a,b){return this.attr("transform",function(a,c){return"translate(0,"+b.yScale_(c)+")"})},a.events.enter=function(){var a;return a=this.chart(),this.call(h,a)},a.events.merge=function(){var a,b,e;return a=this.chart(),null!=a.bubbleKey_&&(b=function(){return this instanceof Array?a.bubbleKey_.apply(this,arguments):this.__key__}),e=this.selectAll("circle").data(a.rowData_,b),e.enter().append("circle").call(c,a),e.exit().call(f,a),e.call(d,a),null!=b&&e.each(function(b,c){return this.__key__=a.bubbleKey_(b,c)}),e.transition().call(g,a)},a.events["update:transition"]=function(){var a;return a=this.chart(),this.duration(a.duration_),this.call(h,a)},a.events.exit=function(){return this.remove()},e.layers.bubble=a}.call(this),function(){var b,c,d,f,g,h;b={events:{}},c=.1,d=.15,b.dataBind=function(b){var d,e,f;return d=this.chart(),d.yScale_.domain(a.range(0,b.length)),d.xScale_.domain(a.range(0,d.rowData_(b[0]).length)),e=d.xScale_(1)-d.xScale_(0),f=d.yScale_(1)-d.yScale_(0),e=f>e?e:f,d.radiusScale_.range([0,e*(1-c)/2]),this.selectAll("g.row").data(b)},b.insert=function(){var a;return a=this.chart(),this.append("g").classed("row",!0)},f=function(){return this.attr("r",0),this.attr("fill","white")},g=function(a,b){return this.attr("cx",function(a,c){return b.xScale_(c)}),this.attr("stroke-width",d*b.radiusScale_(1))},h=function(b,c){return this.delay(function(a,b,c){return 10*b+10*c}),this.duration(300),this.attr("r",function(a){return c.radiusScale_(c.radius_(a))}),this.each(function(b){var d;return d=c.colorScale_(c.color_(b)),a.select(this).transition().attr("fill",d)})},b.events.merge=function(){var a,b;return a=this.chart(),this.attr("transform",function(b,c){return"translate(0,"+a.yScale_(c)+")"}),b=this.selectAll("circle").data(function(b){return a.rowData_(b)}),b.enter().append("circle").call(f,a),b.call(g,a)},b.events["merge:transition"]=function(){var a;return a=this.chart(),this.selectAll("circle").call(h,a)},e.bubblesOptions=b}.call(this),function(){var a,b;a={events:{}},a.dataBind=function(a){var b;return b=this.chart(),this.selectAll("text").data(a.cols,b.colKey_)},a.insert=function(){var a;return a=this.chart(),this.append("text").attr("opacity",0)},b=function(a,b){var c,d;return c=b.bottomMargin_,d=b.slanted_,this.attr("transform",function(a,e){var f;return f="translate("+b.xScale_(e)+","+c+")",d&&(f+="rotate(45)"),f})},a.events.enter=function(){return this.call(b,this.chart())},a.events.merge=function(){var a;return a=this.chart(),this.text(a.colHeader_)},a.events["enter:transition"]=function(){var a;return a=this.chart(),this.duration(a.duration_),this.attr("opacity",1)},a.events["update:transition"]=function(){var a;return a=this.chart(),this.duration(a.duration_),this.call(b,a)},a.events.exit=function(){return this.remove()},e.layers["col-header"]=a}.call(this),function(){var a,b;a={events:{}},a.dataBind=function(a){var b;return b=this.chart(),this.selectAll("text").data(a.rows,b.rowKey_)},a.insert=function(){var a;return a=this.chart(),this.append("text").attr("opacity",0).attr("dy",".38em")},b=function(a,b){var c,d;return c=b.width(),d=b.rowHeaderLeft_,this.attr("transform",function(a,c){return"translate("+d+","+b.yScale_(c)+")"})},a.events.enter=function(){var a;return a=this.chart(),this.call(b,a)},a.events.merge=function(){var a;return a=this.chart(),this.text(function(){return a.rowHeader_.apply(this,arguments)})},a.events["enter:transition"]=function(){var a;return a=this.chart(),this.duration(a.duration_),this.attr("opacity",1)},a.events["update:transition"]=function(){var a;return a=this.chart(),this.duration(a.duration_),this.call(b,a)},a.events["exit:transition"]=function(){var a;return a=this.chart(),this.duration(a.duration_),this.attr("opacity",0).remove()},e.layers["row-header"]=a}.call(this),function(){var a,b,c;a={events:{}},b=1,a.dataBind=function(a){var b;return b=this.chart(),this.selectAll("g.thread").data(a.rows,b.rowKey_)},a.insert=function(){var a,b;return a=this.chart(),b=this.append("g").classed("thread",!0).attr("opacity",0),b.append("path"),b},c=function(a,b){return this.attr("transform",function(a,c){return"translate(0,"+b.yScale_(c)+")"})},a.events.enter=function(){return this.call(c,this.chart())},a.events.merge=function(){var a,c,d,e,f;return a=this.chart(),c=a.xScale_.range(),d=a.leftMargin_,e=b*a.maxRadius_,f="M "+d+" -"+e/2+" v "+e,f+="M "+d+" 0 H "+c[c.length-1],this.select("path").attr("d",f)},a.events["enter:transition"]=function(){var a;return a=this.chart(),this.duration(a.duration_),this.attr("opacity",1)},a.events["update:transition"]=function(){var a;return a=this.chart(),this.duration(a.duration_),this.call(c,a)},a.events["exit:transition"]=function(){var a;return a=this.chart(),this.duration(a.duration_),this.attr("opacity",0).remove()},e.layers.thread=a}.call(this),function(){var b,c,f,g,h,i,j,k;b=e.makeProp,c="BubbleMatrix",f="d3-chart-bubble-matrix",g=1,h=1,i=.1,j=["#b2182b","#d6604d","#f4a582","#fddbc7","#f7f7f7","#d1e5f0","#92c5de","#4393c3","#2166ac"],k=function(){return a.scale.quantize().domain([0,1]).range(j)},e.Chart=a.chart("BaseChart").extend(c,{initialize:function(){var b,c,d,g,h,i=[];for(this.loadDefaults_(),this.base.classed(f,!0),this.xScale_=a.scale.ordinal(),this.yScale_=a.scale.ordinal(),this.radiusScale_=a.scale.sqrt(),this.leftMargin_=0,this.ruler_=e.textRuler(this.base),b=0,d=(c=["thread","bubble","row-header","col-header"]).length;d>b;++b)g=c[b],h=this.base.append("g").classed(g,!0),i.push(this.layer(g,h,e.layers[g]));return i},loadDefaults_:function(){return this.rows_||this.rows(function(a){return a.rows}),this.rowHeader_||this.rowHeader(function(a){return a.name}),this.rowData_||this.rowData(function(a){return a.values}),this.column_||this.columns(function(a){return a.columns}),this.colHeader_||this.colHeader(function(a){return a}),this.size_||this.size(function(a){return a[0]}),this.color_||this.color(function(a){return a[1]}),this.colorScale_||this.colorScale(k()),this.slanted_||this.slanted(!1),this.duration_||this.duration(250)},transform:function(b){var c,d,e,f,j,k,l,m,n;return c=this.rows_(b),d=this.columns_(b),e=this.updateLeftMargin_(c,this.width()),f=this.getMaxBottom_(d,this.height()),j=(this.width()-e)/d.length,k=(f-0)/c.length,this.xScale_.domain(a.range(0,d.length)),this.yScale_.domain(a.range(0,c.length)),l=k>j?j:k,m=e+l*d.length,f=l*c.length,this.xScale_.rangePoints([e,m],g),this.yScale_.rangePoints([0,f],h),n=this.ruler_.extentOfChar("W").height,this.bottomMargin_=f+1.3*n,l=this.xScale_(1)-this.xScale_(0),this.maxRadius_=l*(1-i)/2,this.radiusScale_.range([0,this.maxRadius_]),{rows:c,cols:d}},updateLeftMargin_:function(a){var b,c,e=this;return b=this.leftMargin_,this.rowHeaderLeft_=d.reduce(a,function(a,b){var c;return a>(c=e.ruler_(e.rowHeader_(b)))?a:c}),c=this.ruler_.extentOfChar("W").width,this.rowHeaderLeft_+=c,this.leftMargin_=this.rowHeaderLeft_+c,this.leftMargin_!==b&&this.trigger("margin",this.leftMargin_),this.leftMargin_+this.ruler_.extentOfChar("W").width},getMaxBottom_:function(a,b){return b-2*this.ruler_.extentOfChar("W").height},rows:b("rows_"),rowHeader:b("rowHeader_"),rowKey:b("rowKey_"),rowData:b("rowData_"),columns:b("columns_"),colHeader:b("colHeader_"),colKey:b("colKey_"),size:b("size_"),color:b("color_"),sizeDomain:b("sizeDomain_",function(a){return this.radiusScale_.domain(a)}),colorScale:b("colorScale_"),slanted:b("slanted_"),duration:b("duration_")})}.call(this),e});