/*! d3.chart.bubble-matrix v0.1.7 - MIT Expat */
!function(t){return"object"==typeof exports&&"object"==typeof module?void(module.exports=t(require("d3"),require("d3.chart"),require("d3.chart.base"),require("lodash"))):"function"==typeof define&&define.amd?define(["d3","d3.chart","d3.chart.base","lodash"],t):void(this.d3ChartBubbleMatrix=t(this.d3,this.d3Chart,this.d3ChartBase,this._))}(function(t,r,e,n){"use strict";var i={};return function(){i.makeProp=function(t,r){return function(e){return null==e?this[t]:(this[t]=e,null!=r&&r.call(this,e),this)}},i.textRuler=function(t){var r,e;return r=function(r,e){var n,i;return n=t.append("text").text(r),i=e(n),n.remove(),i},e=n.memoize(function(t){return r(t,function(t){return t.node().getComputedTextLength()})}),e.extentOfChar=n.memoize(function(t){if(t.length<1)throw new Error("char can't be empty");if(t.length>1)throw new Error("can get extent of a full string");return r(t,function(t){return t.node().getExtentOfChar(0)})}),e.onTmpText=r,e},i.layers={}}.call(this),function(){var t,r,e,n,a,s,o;s={events:{}},t=.15,s.dataBind=function(t){var r;return r=this.chart(),r.colKey_?r.bubbleKey_=function(e,n){return r.colKey_(t.cols[n],n)}:r.bubbleKey_=void 0,this.selectAll("g.row").data(t.rows,r.rowKey_)},s.insert=function(){var t;return t=this.chart(),this.append("g").classed("row",!0)},r=function(t,r){return this.attr("r",0),this.attr("fill",function(t){return r.colorScale_(r.color_(t))}),this.attr("opacity",0),this.attr("cx",function(t,e){return r.xScale_(e)})},n=function(r,e){return this.attr("stroke-width",t*e.maxRadius_)},e=function(t,r){return this.remove()},a=function(t,r){return this.duration(r.duration_),this.attr("opacity",1),this.attr("cx",function(t,e){return r.xScale_(e)}),this.attr("r",function(t){return r.radiusScale_(r.size_(t))}),this.attr("fill",function(t){return r.colorScale_(r.color_(t))})},o=function(t,r){return this.attr("transform",function(t,e){return"translate(0,"+(r.yScale_(e)+20)+")"})},s.events.enter=function(){var t;return t=this.chart(),this.call(o,t)},s.events.merge=function(){var t,i,s;return i=this.chart(),null!=i.bubbleKey_&&(s=function(){return this instanceof Array?i.bubbleKey_.apply(this,arguments):this.__key__}),t=this.selectAll("circle").data(i.rowData_,s),t.enter().append("circle").call(r,i),t.exit().call(e,i),t.call(n,i),null!=s&&t.each(function(t,r){return this.__key__=i.bubbleKey_(t,r)}),t.transition().call(a,i)},s.events["update:transition"]=function(){var t;return t=this.chart(),this.duration(t.duration_),this.call(o,t)},s.events.exit=function(){return this.remove()},i.layers.bubble=s}.call(this),function(){var t,r;t={events:{}},t.dataBind=function(t){var r;return r=this.chart(),this.selectAll("text").data(t.cols,r.colKey_)},t.insert=function(){var t;return t=this.chart(),this.append("text").attr("opacity",0)},r=function(t,r){var e,n;return e=r.bottomMargin_,n=r.slanted_,this.attr("transform",function(t,i){var a;return a="translate("+r.xScale_(i)+","+(e+20)+")",n&&(a+="rotate(45)"),a})},t.events.enter=function(){return this.call(r,this.chart())},t.events.merge=function(){var t;return t=this.chart(),this.text(t.colHeader_)},t.events["enter:transition"]=function(){var t;return t=this.chart(),this.duration(t.duration_),this.attr("opacity",1)},t.events["update:transition"]=function(){var t;return t=this.chart(),this.duration(t.duration_),this.call(r,t),this.attr("opacity",1)},t.events.exit=function(){return this.remove()},i.layers["col-header"]=t}.call(this),function(){var t,r;t={events:{}},t.dataBind=function(t){var r;return r=this.chart(),this.selectAll("text").data(t.cols,r.colKey_)},t.insert=function(){var t;return t=this.chart(),this.append("text").attr("opacity",0)},r=function(t,r){var e,n;return e=10,n=r.slanted_,this.attr("transform",function(t,i){var a;return a="translate("+r.xScale_(i)+","+e+")",n&&(a+="rotate(45)"),a})},t.events.enter=function(){return this.call(r,this.chart())},t.events.merge=function(){var t;return t=this.chart(),this.text(t.colHeader_)},t.events["enter:transition"]=function(){var t;return t=this.chart(),this.duration(t.duration_),this.attr("opacity",1)},t.events["update:transition"]=function(){var t;return t=this.chart(),this.duration(t.duration_),this.call(r,t),this.attr("opacity",1)},t.events.exit=function(){return this.remove()},i.layers["col-header-top"]=t}.call(this),function(){var t,r;t={events:{}},t.dataBind=function(t){var r;return r=this.chart(),this.selectAll("text").data(t.rows,r.rowKey_)},t.insert=function(){var t;return t=this.chart(),this.append("text").attr("opacity",0).attr("dy","0.38em")},r=function(t,r){var e,n;return n=r.width(),e=r.rowHeaderLeft_,this.attr("transform",function(t,n){return"translate("+e+","+(r.yScale_(n)+20)+")"})},t.events.enter=function(){var t;return t=this.chart(),this.call(r,t)},t.events.merge=function(){var t;return t=this.chart(),this.text(function(){return t.rowHeader_.apply(this,arguments)})},t.events["enter:transition"]=function(){var t;return t=this.chart(),this.duration(t.duration_),this.attr("opacity",1)},t.events["update:transition"]=function(){var t;return t=this.chart(),this.duration(t.duration_),this.call(r,t),this.attr("opacity",1)},t.events["exit:transition"]=function(){var t;return t=this.chart(),this.duration(t.duration_),this.attr("opacity",0).remove()},i.layers["row-header"]=t}.call(this),function(){var t,r,e;r={events:{}},t=1,r.dataBind=function(t){var r;return r=this.chart(),this.selectAll("g.thread").data(t.rows,r.rowKey_)},r.insert=function(){var t,r;return t=this.chart(),r=this.append("g").classed("thread",!0).attr("opacity",0),r.append("path"),r},e=function(t,r){return this.attr("transform",function(t,e){return"translate(0,"+(r.yScale_(e)+20)+")"})},r.events.enter=function(){return this.call(e,this.chart())},r.events.merge=function(){var r,e,n,i,a;return r=this.chart(),i=r.xScale_.range(),e=r.leftMargin_,a=t*r.maxRadius_,n="M "+e+" -"+a/2+" v "+a,n+="M "+e+" 0 H "+i[i.length-1],this.select("path").attr("d",n)},r.events["enter:transition"]=function(){var t;return t=this.chart(),this.duration(t.duration_),this.attr("opacity",1)},r.events["update:transition"]=function(){var t;return t=this.chart(),this.duration(t.duration_),this.call(e,t),this.attr("opacity",1)},r.events["exit:transition"]=function(){var t;return t=this.chart(),this.duration(t.duration_),this.attr("opacity",0).remove()},i.layers.thread=r}.call(this),function(){var r,e,a,s,o,h,c,u;u=i.makeProp,e="BubbleMatrix",r="d3-chart-bubble-matrix",s=1,h=1,o=.1,a=["#b2182b","#d6604d","#f4a582","#fddbc7","#f7f7f7","#d1e5f0","#92c5de","#4393c3","#2166ac"],c=function(){return t.scale.quantize().domain([0,1]).range(a)},i.Chart=t.chart("BaseChart").extend(e,{initialize:function(){var e,n,a,s,o,h;for(this.loadDefaults_(),this.base.classed(r,!0),this.xScale_=t.scale.ordinal(),this.yScale_=t.scale.ordinal(),this.radiusScale_=t.scale.sqrt(),this.leftMargin_=0,o=["thread","bubble","row-header","col-header","col-header-top"],h=[],a=0,s=o.length;s>a;a++)n=o[a],e=this.base.append("g").classed(n,!0),h.push(this.layer(n,e,i.layers[n]));return h},loadDefaults_:function(){return this.rows_||this.rows(function(t){return t.rows}),this.rowHeader_||this.rowHeader(function(t){return t.name}),this.rowData_||this.rowData(function(t){return t.values}),this.column_||this.columns(function(t){return t.columns}),this.colHeader_||this.colHeader(function(t){return t}),this.size_||this.size(function(t){return t[0]}),this.color_||this.color(function(t){return t[1]}),this.colorScale_||this.colorScale(c()),this.slanted_||this.slanted(!1),this.duration_||this.duration(250)},transform:function(r){var e,n,a,c,u,l,d,f,_;return this.ruler_=i.textRuler(this.base),d=this.rows_(r),n=this.columns_(r),c=this.updateLeftMargin_(d,this.width()),e=this.getMaxBottom_(n,this.height()-20),f=(this.width()-c)/n.length,_=(e-0)/d.length,this.xScale_.domain(t.range(0,n.length)),this.yScale_.domain(t.range(0,d.length)),a=Math.min(f,_),l=c+a*n.length,e=a*d.length,this.xScale_.rangePoints([c,l],s),this.yScale_.rangePoints([0,e],h),u=this.ruler_.extentOfChar("W").height,this.bottomMargin_=e+1.3*u,a=this.xScale_(1)-this.xScale_(0),this.maxRadius_=a*(1-o)/2,this.radiusScale_.range([0,this.maxRadius_]),{rows:d,cols:n}},updateLeftMargin_:function(t,r){var e,i,a,s=this;return e=this.leftMargin_,i=function(t,r,e){return Math.max(t,s.ruler_(s.rowHeader_(r,e)))},this.rowHeaderLeft_=n.reduce(t,i,0),a=this.ruler_.extentOfChar("W").width,this.rowHeaderLeft_+=a,this.leftMargin_=this.rowHeaderLeft_+a,this.leftMargin_!==e&&this.trigger("margin",this.leftMargin_),this.leftMargin_+this.ruler_.extentOfChar("W").width},getMaxBottom_:function(t,r){return r-2*this.ruler_.extentOfChar("W").height},rows:u("rows_"),rowHeader:u("rowHeader_"),rowKey:u("rowKey_"),rowData:u("rowData_"),columns:u("columns_"),colHeader:u("colHeader_"),colKey:u("colKey_"),size:u("size_"),color:u("color_"),sizeDomain:u("sizeDomain_",function(t){return this.radiusScale_.domain(t)}),colorScale:u("colorScale_"),slanted:u("slanted_"),duration:u("duration_")})}.call(this),i});
